### 处理错误
#### 添加try/catch
```tsx
try{}
catch(error){
    console.error(error);
    return {
        message: 'Database Error: Failed to fetch data'
    }
}
```
#### 使用error.tsx处理所有错误
```tsx
'use client';
 
import { useEffect } from 'react';
 
export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  useEffect(() => {
    // Optionally log the error to an error reporting service
    console.error(error);
  }, [error]);
 
  return (
    <main className="flex h-full flex-col items-center justify-center">
      <h2 className="text-center">Something went wrong!</h2>
      <button
        className="mt-4 rounded-md bg-blue-500 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-400"
        onClick={
          // Attempt to recover by trying to re-render the invoices route
          () => reset()
        }
      >
        Try again
      </button>
    </main>
  );
}
```
reset函数可以重新渲染页面  
#### 使用not-found.tsx处理404错误
```tsx
if(!invoice){
    notFound();
}
```
```tsx
import Link from 'next/link';
import { FaceFrownIcon } from '@heroicons/react/24/outline';
 
export default function NotFound() {
  return (
    <main className="flex h-full flex-col items-center justify-center gap-2">
      <FaceFrownIcon className="w-10 text-gray-400" />
      <h2 className="text-xl font-semibold">404 Not Found</h2>
      <p>Could not find the requested invoice.</p>
      <Link
        href="/dashboard/invoices"
        className="mt-4 rounded-md bg-blue-500 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-400"
      >
        Go Back
      </Link>
    </main>
  );
}
```

### 提高可访问性
#### 表单验证
客户端验证：form组件添加required属性  
服务器端验证：
使用aria-describedby属性，添加错误提示信息
```tsx
<select
              id="customer"
              name="customerId"
              className="peer block w-full cursor-pointer rounded-md border border-gray-200 py-2 pl-10 text-sm outline-2 placeholder:text-gray-500"
              defaultValue=""
              aria-describedby="customer-error"
            > 
<div id="customer-error" aria-live="polite" aria-atomic="true">
            {state.errors?.customerId && state.errors.customerId.map((error:string)=>(
              <p className="mt-2 text-sm text-red-500" key={error}>{error}</p>
            ))}
          </div>
```
使用useActionState钩子获取错误信息
```tsx
const initialState :State={ message: null, errors: {} };
const [state, formAction] = useActionState(updateInvoiceWithId, initialState);
```
```tsx
export async function updateInvoice(id:string,prevState:State,formData:FormData){
    //使用schema验证表单数据
    const validatedFields=UpdateInvoice.safeParse({
        customerId:formData.get('customerId'),
        amount:formData.get('amount'),
        status:formData.get('status'),
    });
    if(!validatedFields.success){
        return {
            errors: validatedFields.error.flatten().fieldErrors,
            message: 'Invalid data. Please fix the errors and try again.',
        }
    }
    const {customerId,amount,status}=validatedFields.data;
    //...
}

### 身份验证与授权
身份验证确保用户身份真实，授权确保用户有权访问资源  

#### 创建登录路由
```tsx
import AcmeLogo from '@/app/ui/acme-logo';
import LoginForm from '@/app/ui/login-form';
import { Suspense } from 'react';
 
export default function LoginPage() {
  return (
    <main className="flex items-center justify-center md:h-screen">
      <div className="relative mx-auto flex w-full max-w-[400px] flex-col space-y-2.5 p-4 md:-mt-32">
        <div className="flex h-20 w-full items-end rounded-lg bg-blue-500 p-3 md:h-36">
          <div className="w-32 text-white md:w-36">
            <AcmeLogo />
          </div>
        </div>
        <Suspense>
          <LoginForm />
        </Suspense>
      </div>
    </main>
  );
}
```

#### 使用NextAuth.js实现身份验证

AUTH_SECRET=37bab9bef5048ecbc16740d29428283a  
添加一个路由保护页面  

### 元数据
基于配置：在layout/page中添加metadata 对象或generateMetadata函数  
基于文件：  
favicon.ico apple-icon.jpg icon.jpg 网站图标  
opengraph-image.jpg 社交媒体分享图片  
robots.txt 搜索引擎爬虫控制  
sitemap.xml 有关网站结构的信息  

